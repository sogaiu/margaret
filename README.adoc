= Margaret - Janet's peg/match in Janet
:toc:

This aims to be a pure-Janet implementation of Janet's `peg/match`.

== Background

While reading bakpakin's https://bakpakin.com/writing/how-janets-peg-works.html[How Janet's PEG module works], started typing the code in and evaluating it, next thing I knew...

== Status

In progress, see <<Specials Implementation Status>> for details.

== Why?

* Aid in understanding Janet's PEG system
* Generate example PEG specials usages
* Experiment with adding diagnostic info / tracing
* Experiment with additional constructs

== Setup

* Clone this repository and cd to the relevant directory

* Ensure `janet` and `jpm` are on your `PATH`

* Install if you like: `jpm install`

== Usage

`meg/match` is an attempt at implementing `peg/match`, so for example:

[source,janet]
----
(import margaret/meg)

(meg/match ~(capture (some "smile")) "smile!")
----

should work.

There is some support for diagnostic output via the dynamic variable `:meg-debug`.

To try it, do:

[source,janet]
----
(setdyn :meg-debug true)
----

or for more detailed info:

[source,janet]
----
(setdyn :meg-debug {:captures true
                    :peg true
                    :text true})
----

before calling `meg/match`.

Output format is still evolving but likely will support at least:

. capture stack
. tags
. specials execution order

== Testing

Run all tests by:

* `jpm test` from the project directory of margaret

There are currently tests for:

* link:margaret/meg.janet[margaret's `meg` module]

* link:examples/stand-alone/tutorial.janet[`peg` module tutorial]

* link:examples/stand-alone/article.janet[modified code from bakpakin's article]

== Specials Implementation Status

Mostly done:

. Primitive Patterns
.. integer
.. range
.. set
.. string

. Combinators
.. any
.. at-least
.. at-most
.. backmatch
.. between
.. choice, {plus}
.. if
.. if-not
.. look, >
.. opt, ?
.. repeat, "n"
.. sequence, *
.. some
.. thru
.. to

. Captures
.. accumulate, %
.. argument
.. backref, \->
.. capture, \<-, quote
.. cmt
.. column
.. constant
.. drop
.. error
.. group
.. lenprefix
.. line
.. position
.. replace, /

Todo:

. Captures
.. int
.. int-be
.. uint
.. uint-be

== Acknowledgments

Thanks to (at least) the following folks:

* ahungry
* andrewchambers
* bakpakin
* crocket
* goto-engineering
* ikarius
* jcmkk3
* LeafGarland
* leahneukirchen
* LeviSchuck
* MikeBeller
* nate
* pepe
* pyrmont
* Saikyun
* subsetpark
* swlkr
* tami5
* uvtc
* yumaikas

...and other Janet community members :)
